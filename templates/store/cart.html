{% extends 'base.html' %}
{% load static %}
{% block content %}

<section class="section-content padding-y bg">
<div class="container">

{% if not cart_items %}
    <h2 class="text-center">Empty shopping cart</h2>
    <br>
    <div class="text-center">
        <a href="{% url 'store' %}" class="btn btn-primary theme-btn">Continue Shopping</a>
    </div>
{% else %}
    <div class="row">
        <aside class="col-lg-9">
    <div class="card shadow-sm rounded-4">
    <table class="table table-borderless table-shopping-cart align-middle">
    <thead class="text-muted bg-light">
    <tr class="small text-uppercase">
    <th scope="col">Product</th>
    <th scope="col" width="140">Quantity</th>
    <th scope="col" width="120">Price</th>
    <th scope="col" class="text-right" width="200"></th>
    </tr>
    </thead>
    <tbody>
    {% for cart_item in cart_items %}
    <tr>
        <td>
            <figure class="itemside align-items-center">
                <div class="aside"><img src="{{ cart_item.product.images.url }}" class="img-sm rounded shadow-sm"></div>
                <figcaption class="info">
                    <a href="{{ cart_item.product.get_url }}" class="title text-dark fw-bold">{{ cart_item.product.product_name }}</a>
                    <p class="text-muted small mb-0">
                        {% if cart_item.variations.all %}
                            {% for item in cart_item.variations.all %}
                                {{ item.variation_category | capfirst }} : {{ item.variation_value | capfirst}} <br>
                            {% endfor %}
                        {% endif %}
                    </p>
                </figcaption>
            </figure>
        </td>
        <td>
            <div class="col">
                <div class="input-group input-spinner">
                    <!-- Minus Button -->
                    <form action="{% url 'remove_cart' cart_item.product.id cart_item.id %}" method="POST" class="d-inline">
                        {% csrf_token %}
                        {% for item in cart_item.variations.all %}
                            <input type="hidden" name="{{ item.variation_category|lower }}" value="{{ item.variation_value }}">
                        {% endfor %}
                        <button class="btn btn-qty btn-minus" type="submit">
                            <i class="fa fa-minus"></i>
                        </button>
                    </form>

                    <!-- Quantity -->
                    <input type="text" class="form-control text-center bg-light fw-bold" value="{{ cart_item.quantity }}" readonly style="max-width: 60px;">

                    <!-- Plus Button -->
                    <form action="{% url 'add_cart' cart_item.product.id %}" method="POST" class="d-inline">
                        {% csrf_token %}
                        {% for item in cart_item.variations.all %}
                            <input type="hidden" name="{{ item.variation_category|lower }}" value="{{ item.variation_value }}">
                        {% endfor %}
                        <button class="btn btn-qty btn-plus" type="submit">
                            <i class="fa fa-plus"></i>
                        </button>
                    </form>
                </div>
            </div>
        </td>
        <td>
            <div class="price-wrap">
                <var class="price text-primary fw-bold">$ {{ cart_item.sub_total }}</var>
                <small class="text-muted"> ${{ cart_item.product.price }} each </small>
            </div>
        </td>
        <td class="text-right">
            <a href="{% url 'remove_cart_item' cart_item.product.id cart_item.id %}"
               onclick="return confirm('Are you sure you want to delete this item?')"
               class="btn btn-remove">
               Remove
            </a>
        </td>
    </tr>
    {% endfor %}
    </tbody>
    </table>
    </div>
        </aside>

        <aside class="col-lg-3">
            <div class="card shadow-sm rounded-4">
            <div class="card-body">
                <dl class="dlist-align">
                <dt>Total price:</dt>
                <dd class="text-right">$ {{total}}</dd>
                </dl>
                <dl class="dlist-align">
                <dt>Tax:</dt>
                <dd class="text-right"> ${{ tax }}</dd>
                </dl>
                <dl class="dlist-align">
                <dt>Total:</dt>
                <dd class="text-right text-dark b"><strong>$ {{ grand_total }}</strong></dd>
                </dl>
                <hr>
                <p class="text-center mb-3">
                    <img src="{% static './images/misc/payments.png' %}" height="26">
                </p>
                <a href="{% url 'checkout' %}" class="btn btn-primary theme-btn w-100 mb-2">Checkout</a>
                <a href="{% url 'store' %}" class="btn btn-outline-primary theme-btn-outline w-100">Continue Shopping</a>
            </div>
            </div>
        </aside>
{% endif %}
</div>
</div>
</section>

<style>
    /* Pok√©Store Theme Button */
    .theme-btn {
        background: linear-gradient(90deg, #ffcb05, #ffdd57);
        color: #2d2d2d;
        border: none;
        font-weight: bold;
        transition: 0.3s;
    }
    .theme-btn:hover {
        background: red;
        color: white;
        border: 2px solid black;
        transform: translateY(-2px);

    }
    .theme-btn-outline {
        border: 2px solid yellow;
        color: #2d2d2d;
        font-weight: bold;
        background: white;
        transition: 0.3s;
    }
    .theme-btn-outline:hover {
        background: #ffcb05;
        color: #2d2d2d;
    }

    /* Quantity Buttons */
    .btn-qty {
        background: #ffcb05;
        color: #2d2d2d;
        border: none;
        font-weight: bold;
        width: 36px;
        height: 36px;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: 0.2s;
        border: 2px solid transparent;
    }
    .btn-qty:hover {
        background: red;
        color: white;
        border: 2px solid black;
        transform: scale(1.1);
    }

    /* Remove Button */
    .btn-remove {
        background: grey;
        color: white;
        border: none;
        padding: 6px 12px;
        border-radius: 6px;
        font-weight: bold;
        transition: 0.3s;
    }
    .btn-remove:hover {
        background: #ffdd57;
        color: #2d2d2d;
        transform: scale(1.1) rotate(-2deg);
    }
</style>

{% endblock %}
